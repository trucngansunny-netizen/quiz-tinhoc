<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>H·ªÜ TH·ªêNG CH·∫§M ƒêI·ªÇM TIN H·ªåC</title>
<style>
  :root { --card-bg: rgba(255,255,255,0.0); --panel-pad: 14px; --accent: #0b76ef; }
  body {
    font-family: "Segoe UI", sans-serif;
    color: #0b2435;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    background: url("/static/{{ background }}") no-repeat center center / cover;
    transition: background 0.4s ease;
  }
  .container {
    width: 94%;
    max-width: 980px;
    margin: 24px auto;
    padding: 18px;
    color: #082034;
    /* no white box ‚Äî content lays on background */
  }
  header {
    text-align: center;
    padding: 12px 0 6px;
  }
  h1 {
    margin: 0;
    font-size: 1.6rem;
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(0,0,0,0.2);
  }
  p.subtitle { margin: 6px 0 18px; color: rgba(0,0,0,0.6); }

  .row { display:flex; gap:12px; flex-wrap:wrap; align-items:flex-start; }
  .col { flex:1 1 280px; min-width:240px; }

  label { font-weight:600; display:block; margin-bottom:8px; }
  select, input[type="file"], input[type="text"] {
    width:100%;
    padding:10px;
    border-radius:10px;
    border:1px solid rgba(0,0,0,0.15);
    background: rgba(255,255,255,0.85);
  }

  button.btn {
    display:inline-block;
    padding:12px 16px;
    border-radius:10px;
    border:none;
    background: var(--accent);
    color:white;
    font-weight:700;
    cursor:pointer;
    box-shadow: 0 6px 14px rgba(11,118,239,0.18);
  }
  button.btn:active { transform: translateY(1px); }

  .panel {
    padding: var(--panel-pad);
    border-radius:12px;
    background: rgba(255,255,255,0.6);
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  }

  .criteria-list { margin:8px 0 0 0; padding:0; list-style:none; }
  .criteria-list li { padding:6px 8px; border-radius:8px; margin-bottom:6px; background: rgba(255,255,255,0.85); }
  .result-box { margin-top:12px; padding:12px; border-radius:10px; background: rgba(255,255,255,0.85); }

  .footer {
    margin-top:18px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    color: rgba(0,0,0,0.7);
    font-size:0.95rem;
  }

  .note { font-size:0.9rem; color:rgba(0,0,0,0.6); }

  @media (max-width:720px){
    .row { flex-direction:column; }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üíª H·ªÜ TH·ªêNG CH·∫§M ƒêI·ªÇM TIN H·ªåC</h1>
      <p class="subtitle">Ch·ªçn kh·ªëi ‚Üí ch·ªçn ph·∫ßn m·ªÅm ‚Üí t·∫£i t·ªáp b√†i l√†m ‚Üí ch·∫•m t·ª± ƒë·ªông theo ti√™u ch√≠</p>
    </header>

    <form method="POST" enctype="multipart/form-data">
      <div class="row">
        <div class="col panel">
          <label for="lop">üéì Ch·ªçn l·ªõp</label>
          <select id="lop" name="lop" required>
            <option value="">-- ch·ªçn l·ªõp --</option>
            {% for c in classes %}
              <option value="{{ c }}" {% if c==selected_class %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>

          <label for="software" style="margin-top:12px;">üß© Ch·ªçn ph·∫ßn m·ªÅm</label>
          <select id="software" name="software" required>
            <option value="">-- ch·ªçn ph·∫ßn m·ªÅm --</option>
            {% for s in softwares %}
              <option value="{{s}}" {% if s==selected_software %}selected{% endif %}>{{s}}</option>
            {% endfor %}
          </select>

          <label style="margin-top:12px;">üìÇ T·∫£i t·ªáp b√†i l√†m (pptx / docx / sb3)</label>
          <input type="file" name="file" accept=".pptx,.docx,.sb3,.zip" required>

          <div style="margin-top:12px;">
            <button class="btn" type="submit">B·∫Øt ƒë·∫ßu ch·∫•m</button>
          </div>
        </div>

        <div class="col panel">
          <label>üìã Ti√™u ch√≠ ch·∫•m (t·ª± l·∫•y t·ª´ th∆∞ m·ª•c <code>/criteria</code>)</label>
          {% if criteria %}
            <ul class="criteria-list">
              {% for it in criteria %}
                <li><strong>{{ it.mo_ta }}</strong> ‚Äî <em>{{ it.diem }}ƒë</em></li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="note">Ch∆∞a c√≥ ti√™u ch√≠ hi·ªÉn th·ªã. Sau khi ch·ªçn kh·ªëi + ph·∫ßn m·ªÅm, h·ªá th·ªëng s·∫Ω n·∫°p ti√™u ch√≠ t·ª± ƒë·ªông (t·ª´ folder <code>criteria/</code>).</div>
          {% endif %}
          {% if message %}
            <div style="margin-top:10px;color:#b03;">‚ö†Ô∏è {{ message }}</div>
          {% endif %}
        </div>
      </div>
    </form>

    {% if result %}
    <div class="result-box panel" style="margin-top:14px;">
      <h3>K·∫øt qu·∫£ ch·∫•m ‚Äî {{ result.student }}</h3>
      <p><strong>File:</strong> {{ result.file }} &nbsp; ‚Ä¢ &nbsp; <strong>ƒêi·ªÉm:</strong> {{ result.score }}/10</p>
      <div>
        <strong>Nh·∫≠n x√©t:</strong>
        <ul>
          {% for n in result.notes %}
            <li>{{ n }}</li>
          {% endfor %}
        </ul>
      </div>
      <div style="margin-top:8px;">
        <a href="/static/{{ result.file }}" style="font-size:0.9rem;color:var(--accent);">(T·∫£i l·∫°i t·ªáp ƒë√£ n·ªôp)</a>
      </div>
    </div>
    {% endif %}

    <div class="footer">
      <div class="note">üìÅ K·∫øt qu·∫£ l∆∞u trong th∆∞ m·ª•c <code>/results</code> (m·ªói l·ªõp 1 file Excel)</div>
      <div>üëÅÔ∏è L∆∞·ª£t truy c·∫≠p: {{ counter }}</div>
    </div>
  </div>

<script>
  // front-end: hide/show software options based on selected class (kh·ªëi)
  const classSelect = document.getElementById('lop');
  const softwareSelect = document.getElementById('software');

  function adjustSoftwareOptions() {
    const val = classSelect.value;
    if (!val) return;
    const grade = parseInt(val.charAt(0));
    // allowed mapping (must match server-side)
    const map = {
      3: ["PowerPoint"],
      4: ["Word","PowerPoint","Scratch"],
      5: ["Word","Scratch"]
    };
    const allowed = map[grade] || ["PowerPoint","Word","Scratch"];
    // clear and re-add
    softwareSelect.innerHTML = "<option value=''>-- ch·ªçn ph·∫ßn m·ªÅm --</option>";
    allowed.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s; opt.innerText = s;
      softwareSelect.appendChild(opt);
    });
  }

  classSelect.addEventListener('change', adjustSoftwareOptions);
  // initial run if class pre-selected
  if (classSelect.value) adjustSoftwareOptions();
</script>
</body>
</html>
